"use strict";(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([[5346],{3905:function(e,t,n){n.d(t,{Zo:function(){return c},kt:function(){return m}});var r=n(7294);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function s(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?s(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):s(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},s=Object.keys(e);for(r=0;r<s.length;r++)n=s[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(r=0;r<s.length;r++)n=s[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var o=r.createContext({}),u=function(e){var t=r.useContext(o),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},c=function(e){var t=u(e.components);return r.createElement(o.Provider,{value:t},e.children)},p={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},d=r.forwardRef((function(e,t){var n=e.components,a=e.mdxType,s=e.originalType,o=e.parentName,c=l(e,["components","mdxType","originalType","parentName"]),d=u(n),m=a,b=d["".concat(o,".").concat(m)]||d[m]||p[m]||s;return n?r.createElement(b,i(i({ref:t},c),{},{components:n})):r.createElement(b,i({ref:t},c))}));function m(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var s=n.length,i=new Array(s);i[0]=d;var l={};for(var o in t)hasOwnProperty.call(t,o)&&(l[o]=t[o]);l.originalType=e,l.mdxType="string"==typeof e?e:a,i[1]=l;for(var u=2;u<s;u++)i[u]=n[u];return r.createElement.apply(null,i)}return r.createElement.apply(null,n)}d.displayName="MDXCreateElement"},8215:function(e,t,n){var r=n(7294);t.Z=function(e){var t=e.children,n=e.hidden,a=e.className;return r.createElement("div",{role:"tabpanel",hidden:n,className:a},t)}},9877:function(e,t,n){n.d(t,{Z:function(){return c}});var r=n(3117),a=n(7294),s=n(2389),i=n(4726),l=n(6010),o="tabItem_LplD";function u(e){var t,n,s,u=e.lazy,c=e.block,p=e.defaultValue,d=e.values,m=e.groupId,b=e.className,f=a.Children.map(e.children,(function(e){if((0,a.isValidElement)(e)&&void 0!==e.props.value)return e;throw new Error("Docusaurus error: Bad <Tabs> child <"+("string"==typeof e.type?e.type:e.type.name)+'>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.')})),g=null!=d?d:f.map((function(e){var t=e.props;return{value:t.value,label:t.label,attributes:t.attributes}})),h=(0,i.lx)(g,(function(e,t){return e.value===t.value}));if(h.length>0)throw new Error('Docusaurus error: Duplicate values "'+h.map((function(e){return e.value})).join(", ")+'" found in <Tabs>. Every value needs to be unique.');var v=null===p?p:null!=(t=null!=p?p:null==(n=f.find((function(e){return e.props.default})))?void 0:n.props.value)?t:null==(s=f[0])?void 0:s.props.value;if(null!==v&&!g.some((function(e){return e.value===v})))throw new Error('Docusaurus error: The <Tabs> has a defaultValue "'+v+'" but none of its children has the corresponding value. Available values are: '+g.map((function(e){return e.value})).join(", ")+". If you intend to show no default tab, use defaultValue={null} instead.");var T=(0,i.UB)(),k=T.tabGroupChoices,y=T.setTabGroupChoices,w=(0,a.useState)(v),N=w[0],B=w[1],x=[],j=(0,i.o5)().blockElementScrollPositionUntilNextRender;if(null!=m){var O=k[m];null!=O&&O!==N&&g.some((function(e){return e.value===O}))&&B(O)}var S=function(e){var t=e.currentTarget,n=x.indexOf(t),r=g[n].value;r!==N&&(j(t),B(r),null!=m&&y(m,r))},I=function(e){var t,n=null;switch(e.key){case"ArrowRight":var r=x.indexOf(e.currentTarget)+1;n=x[r]||x[0];break;case"ArrowLeft":var a=x.indexOf(e.currentTarget)-1;n=x[a]||x[x.length-1]}null==(t=n)||t.focus()};return a.createElement("div",{className:"tabs-container"},a.createElement("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,l.Z)("tabs",{"tabs--block":c},b)},g.map((function(e){var t=e.value,n=e.label,s=e.attributes;return a.createElement("li",(0,r.Z)({role:"tab",tabIndex:N===t?0:-1,"aria-selected":N===t,key:t,ref:function(e){return x.push(e)},onKeyDown:I,onFocus:S,onClick:S},s,{className:(0,l.Z)("tabs__item",o,null==s?void 0:s.className,{"tabs__item--active":N===t})}),null!=n?n:t)}))),u?(0,a.cloneElement)(f.filter((function(e){return e.props.value===N}))[0],{className:"margin-vert--md"}):a.createElement("div",{className:"margin-vert--md"},f.map((function(e,t){return(0,a.cloneElement)(e,{key:t,hidden:e.props.value!==N})}))))}function c(e){var t=(0,s.Z)();return a.createElement(u,(0,r.Z)({key:String(t)},e))}},2304:function(e,t,n){n.r(t),n.d(t,{frontMatter:function(){return u},contentTitle:function(){return c},metadata:function(){return p},toc:function(){return d},default:function(){return b}});var r=n(3117),a=n(102),s=(n(7294),n(3905)),i=n(9877),l=n(8215),o=["components"],u={id:"tests",title:"Tests",sidebar_label:"Tests",slug:"/tests"},c=void 0,p={unversionedId:"tests",id:"tests",title:"Tests",description:"A Betterer test is a programmatic definition of something that you want to improve in your codebase. Typically this will either be something that is measured across the entire project (e.g. code coverage, or number of tests, or a specific performance metric), or something that is measured on a per-file basis (e.g. type checking, or linting).",source:"@site/docs/tests.md",sourceDirName:".",slug:"/tests",permalink:"/betterer/docs/tests",editUrl:"https://github.com/phenomnomnominal/betterer/edit/master/website/docs/tests.md",tags:[],version:"current",lastUpdatedBy:"Craig Spence",lastUpdatedAt:1636753986,formattedLastUpdatedAt:"11/12/2021",frontMatter:{id:"tests",title:"Tests",sidebar_label:"Tests",slug:"/tests"},sidebar:"docs",previous:{title:"Test definition file",permalink:"/betterer/docs/test-definition-file"},next:{title:"Results file",permalink:"/betterer/docs/results-file"}},d=[{value:"Basic test",id:"basic-test",children:[],level:2},{value:"Skipping and targeting tests",id:"skipping-and-targeting-tests",children:[],level:2},{value:"Test goal",id:"test-goal",children:[],level:2},{value:"Test deadline",id:"test-deadline",children:[],level:2},{value:"File test",id:"file-test",children:[],level:2},{value:"Complex test",id:"complex-test",children:[],level:2}],m={toc:d};function b(e){var t=e.components,n=(0,a.Z)(e,o);return(0,s.kt)("wrapper",(0,r.Z)({},m,n,{components:t,mdxType:"MDXLayout"}),(0,s.kt)("p",null,"A ",(0,s.kt)("strong",{parentName:"p"},"Betterer")," test is a programmatic definition of something that you want to improve in your codebase. Typically this will either be something that is measured ",(0,s.kt)("em",{parentName:"p"},"across the entire project")," (e.g. code coverage, or number of tests, or a specific performance metric), or something that is measured ",(0,s.kt)("em",{parentName:"p"},"on a per-file basis")," (e.g. type checking, or linting)."),(0,s.kt)("p",null,"Tests are defined as code and can be re-used and shared with other projects. ",(0,s.kt)("strong",{parentName:"p"},"Betterer")," even comes with ",(0,s.kt)("a",{parentName:"p",href:"./typescript"},"a")," ",(0,s.kt)("a",{parentName:"p",href:"./eslint"},"few")," ",(0,s.kt)("a",{parentName:"p",href:"./regexp"},"built-in")," ",(0,s.kt)("a",{parentName:"p",href:"./stylelint"},"tests"),"."),(0,s.kt)("h2",{id:"basic-test"},"Basic test"),(0,s.kt)("p",null,"The most basic test you can write checks if a number grows or shrinks:"),(0,s.kt)(i.Z,{groupId:"language",defaultValue:"ts",values:[{label:"TypeScript",value:"ts"},{label:"JavaScript",value:"js"}],mdxType:"Tabs"},(0,s.kt)(l.Z,{value:"ts",mdxType:"TabItem"},(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-typescript"},"// .betterer.ts\nimport { BettererTest } from '@betterer/betterer';\nimport { bigger, smaller } from '@betterer/constraints';\n\nexport default {\n  'should grow': () =>\n    new BettererTest({\n      test: () => getNumberOfTests(),\n      constraint: bigger\n    }),\n  'should shrink': () =>\n    new BettererTest({\n      test: () => getBundleSize(),\n      constraint: smaller\n    })\n};\n\nfunction getNumberOfTests(): number {\n  // ...\n}\n\nfunction getBundleSize(): number {\n  // ...\n}\n"))),(0,s.kt)(l.Z,{value:"js",mdxType:"TabItem"},(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-javascript"},"// .betterer.js\nconst { BettererTest } = require('@betterer/betterer');\nconst { bigger, smaller } = require('@betterer/constraints');\n\nmodule.exports = {\n  'should grow': () =>\n    new BettererTest({\n      test: () => getNumberOfTests(),\n      constraint: bigger\n    }),\n  'should shrink': () =>\n    new BettererTest({\n      test: () => getBundleSize(),\n      constraint: smaller\n    })\n};\n\nfunction getNumberOfTests() {\n  // ...\n}\n\nfunction getBundleSize() {\n  // ...\n}\n")))),(0,s.kt)("h2",{id:"skipping-and-targeting-tests"},"Skipping and targeting tests"),(0,s.kt)("p",null,"A ",(0,s.kt)("a",{parentName:"p",href:"./betterer.betterertest"},(0,s.kt)("inlineCode",{parentName:"a"},"BettererTest"))," has nice helpers for ",(0,s.kt)("a",{parentName:"p",href:"./betterer.betterertest.skip"},"skipping")," tests and ",(0,s.kt)("a",{parentName:"p",href:"./betterer.betterertest.only"},"selecting specific tests")," to run."),(0,s.kt)(i.Z,{groupId:"language",defaultValue:"ts",values:[{label:"TypeScript",value:"ts"},{label:"JavaScript",value:"js"}],mdxType:"Tabs"},(0,s.kt)(l.Z,{value:"ts",mdxType:"TabItem"},(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-typescript"},"// .betterer.ts\nimport { BettererTest } from '@betterer/betterer';\nimport { bigger, smaller } from '@betterer/constraints';\n\nexport default {\n  'should grow': () =>\n    new BettererTest({\n      test: () => getNumberOfTests(),\n      constraint: bigger\n    }).only(),\n  'should shrink': () =>\n    new BettererTest({\n      test: () => getBundleSize(),\n      constraint: smaller\n    }).skip()\n};\n\nfunction getNumberOfTests(): number {\n  // ...\n}\n\nfunction getBundleSize(): number {\n  // ...\n}\n"))),(0,s.kt)(l.Z,{value:"js",mdxType:"TabItem"},(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-javascript"},"// .betterer.js\nconst { BettererTest } = require('@betterer/betterer');\nconst { bigger, smaller } = require('@betterer/constraints');\n\nmodule.exports = {\n  'should grow': () =>\n    new BettererTest({\n      test: () => getNumberOfTests(),\n      constraint: bigger\n    }).only(),\n  'should shrink': () =>\n    new BettererTest({\n      test: () => getBundleSize(),\n      constraint: smaller\n    }).skip()\n};\n\nfunction getNumberOfTests() {\n  // ...\n}\n\nfunction getBundleSize() {\n  // ...\n}\n")))),(0,s.kt)("h2",{id:"test-goal"},"Test goal"),(0,s.kt)("p",null,'You can add a goal to your test, which can be a function or a value. Once the goal is met, the test will be marked as "completed":'),(0,s.kt)(i.Z,{groupId:"language",defaultValue:"ts",values:[{label:"TypeScript",value:"ts"},{label:"JavaScript",value:"js"}],mdxType:"Tabs"},(0,s.kt)(l.Z,{value:"ts",mdxType:"TabItem"},(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-typescript"},"// .betterer.ts\nimport { BettererTest } from '@betterer/betterer';\nimport { bigger, smaller } from '@betterer/constraints';\n\nexport default {\n  'should grow': () =>\n    new BettererTest({\n      test: () => getNumberOfTests(),\n      constraint: bigger,\n      goal: (value: number) => value > 1000\n    }),\n  'should shrink': () =>\n    new BettererTest({\n      test: () => getBundleSize(),\n      constraint: smaller,\n      goal: 5\n    })\n};\n\nfunction getNumberOfTests(): number {\n  // ...\n}\n\nfunction getBundleSize(): number {\n  // ...\n}\n"))),(0,s.kt)(l.Z,{value:"js",mdxType:"TabItem"},(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-javascript"},"// .betterer.js\nconst { BettererTest } = require('@betterer/betterer');\nconst { bigger, smaller } = require('@betterer/constraints');\n\nmodule.exports = {\n  'should grow': () =>\n    new BettererTest({\n      test: () => getNumberOfTests(),\n      constraint: bigger,\n      goal: (value) => value > 1000\n    }),\n  'should shrink': () =>\n    new BettererTest({\n      test: () => getBundleSize(),\n      constraint: smaller,\n      goal: 5\n    })\n};\n\nfunction getNumberOfTests() {\n  // ...\n}\n\nfunction getBundleSize() {\n  // ...\n}\n")))),(0,s.kt)("h2",{id:"test-deadline"},"Test deadline"),(0,s.kt)("p",null,"You can add a deadline to your test, which can be a ",(0,s.kt)("a",{parentName:"p",href:"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Date"},(0,s.kt)("inlineCode",{parentName:"a"},"Date")," object"),", or a valid ",(0,s.kt)("a",{parentName:"p",href:"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Date/Date#parameters"},(0,s.kt)("inlineCode",{parentName:"a"},"Date")," string"),'. Once the deadline is passed, the test will be marked as "expired":'),(0,s.kt)(i.Z,{groupId:"language",defaultValue:"ts",values:[{label:"TypeScript",value:"ts"},{label:"JavaScript",value:"js"}],mdxType:"Tabs"},(0,s.kt)(l.Z,{value:"ts",mdxType:"TabItem"},(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-typescript"},"// .betterer.ts\nimport { BettererTest } from '@betterer/betterer';\nimport { bigger, smaller } from '@betterer/constraints';\n\nexport default {\n  'should grow': () =>\n    new BettererTest({\n      test: () => getNumberOfTests(),\n      constraint: bigger,\n      deadline: new Date('2021/07/03')\n    }),\n  'should shrink': () =>\n    new BettererTest({\n      test: () => getBundleSize(),\n      constraint: smaller,\n      deadline: '2021/07/03'\n    })\n};\n\nfunction getNumberOfTests(): number {\n  // ...\n}\n\nfunction getBundleSize(): number {\n  // ...\n}\n"))),(0,s.kt)(l.Z,{value:"js",mdxType:"TabItem"},(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-javascript"},"// .betterer.js\nconst { BettererTest } = require('@betterer/betterer');\nconst { bigger, smaller } = require('@betterer/constraints');\n\nmodule.exports = {\n  'should grow': () =>\n    new BettererTest({\n      test: () => getNumberOfTests(),\n      constraint: bigger,\n      deadline: new Date('2021/07/03')\n    }),\n  'should shrink': () =>\n    new BettererTest({\n      test: () => getBundleSize(),\n      constraint: smaller,\n      deadline: '2021/07/03'\n    })\n};\n\nfunction getNumberOfTests() {\n  // ...\n}\n\nfunction getBundleSize() {\n  // ...\n}\n")))),(0,s.kt)("h2",{id:"file-test"},"File test"),(0,s.kt)("p",null,"If you want to write a test that checks individual files, you can write a ",(0,s.kt)("a",{parentName:"p",href:"./betterer.bettererfiletest"},(0,s.kt)("inlineCode",{parentName:"a"},"BettererFileTest")),":"),(0,s.kt)(i.Z,{groupId:"language",defaultValue:"ts",values:[{label:"TypeScript",value:"ts"},{label:"JavaScript",value:"js"}],mdxType:"Tabs"},(0,s.kt)(l.Z,{value:"ts",mdxType:"TabItem"},(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-typescript"},"// .betterer.ts\nimport { BettererFileTest } from '@betterer/betterer';\n\nexport default {\n  'no more JavaScript files': () => countFiles('no more JavaScript files!').include('**/*.js')\n};\n\nfunction countFiles(issue: string) {\n  return new BettererFileTest(async (filePaths, fileTestResult) => {\n    filePaths.forEach((filePath) => {\n      // In this case the file contents don't matter:\n      const file = fileTestResult.addFile(filePath, '');\n      // Add the issue to the first character of the file:\n      file.addIssue(0, 0, issue);\n    });\n  });\n}\n"))),(0,s.kt)(l.Z,{value:"js",mdxType:"TabItem"},(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-javascript"},"// .betterer.js\nconst { BettererFileTest } = require('@betterer/betterer');\n\nmodule.exports = {\n  'no more JavaScript': () => countFiles('no more JavaScript files!').include('**/*.js')\n};\n\nfunction countFiles(issue) {\n  return new BettererFileTest(async (filePaths, fileTestResult) => {\n    filePaths.forEach((filePath) => {\n      // In this case the file contents don't matter:\n      const file = fileTestResult.addFile(filePath, '');\n      // Add the issue to the first character of the file:\n      file.addIssue(0, 0, issue);\n    });\n  });\n}\n")))),(0,s.kt)("ul",null,(0,s.kt)("li",{parentName:"ul"},(0,s.kt)("a",{parentName:"li",href:"./betterer.bettererfiletest"},"Full ",(0,s.kt)("inlineCode",{parentName:"a"},"BettererFileTest")," API"))),(0,s.kt)("h2",{id:"complex-test"},"Complex test"),(0,s.kt)("p",null,"If you want to do more fancy custom things, you can have complete control over ",(0,s.kt)("a",{parentName:"p",href:"./betterer.betterertestconstraint"},"constraints"),", ",(0,s.kt)("a",{parentName:"p",href:"./betterer.bettererdiffer"},"diffing"),", ",(0,s.kt)("a",{parentName:"p",href:"./betterer.bettererserialiser"},"serialising/deserialising")," and ",(0,s.kt)("a",{parentName:"p",href:"./betterer.bettererprinter"},"printing"),"."),(0,s.kt)(i.Z,{groupId:"language",defaultValue:"ts",values:[{label:"TypeScript",value:"ts"},{label:"JavaScript",value:"js"}],mdxType:"Tabs"},(0,s.kt)(l.Z,{value:"ts",mdxType:"TabItem"},(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-typescript"},"// .betterer.ts\nimport { BettererTest } from '@betterer/betterer';\nimport { BettererConstraintResult } from '@betterer/constraints';\n\ntype AccessibilityReport = {\n  warnings: Array<string>;\n  errors: Array<string>;\n};\n\nexport default {\n  'should be accessible': () =>\n    new BettererTest<AccessibilityReport>({\n      test: accessibilityTest,\n      constraint: accessibilityConstraint\n    })\n};\n\nfunction accessibilityTest(): AccessibilityReport {\n  // ...\n}\n\nfunction accessibilityConstraint(result: AccessibilityReport, expected: AccessibilityReport): BettererConstraintResult {\n  if (result.errors > expected.errors || result.warnings > expected.warnings) {\n    return BettererConstraintResult.worse;\n  }\n  if (result.errors < expected.errors || result.warnings < expected.warnings) {\n    return BettererConstraintResult.better;\n  }\n  return BettererConstraintResult.same;\n}\n"))),(0,s.kt)(l.Z,{value:"js",mdxType:"TabItem"},(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-javascript"},"// .betterer.js\nconst { BettererTest } = require('@betterer/betterer');\nconst { BettererConstraintResult } = require('@betterer/constraints');\n\nmodule.exports = {\n  'should be accessible': () =>\n    new BettererTest({\n      test: accessibilityTest,\n      constraint: accessibilityConstraint\n    })\n};\n\nfunction accessibilityTest() {\n  // ...\n}\n\nfunction accessibilityConstraint(result, expected) {\n  if (result.errors > expected.errors || result.warnings > expected.warnings) {\n    return BettererConstraintResult.worse;\n  }\n  if (result.errors < expected.errors || result.warnings < expected.warnings) {\n    return BettererConstraintResult.better;\n  }\n  return BettererConstraintResult.same;\n}\n")))),(0,s.kt)("ul",null,(0,s.kt)("li",{parentName:"ul"},(0,s.kt)("a",{parentName:"li",href:"./betterer.betterertest"},"Full ",(0,s.kt)("inlineCode",{parentName:"a"},"BettererTest")," API"))))}b.isMDXComponent=!0}}]);