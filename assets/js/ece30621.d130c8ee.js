"use strict";(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([[4077],{3905:function(e,t,n){n.d(t,{Zo:function(){return p},kt:function(){return d}});var r=n(7294);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function l(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?l(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):l(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function o(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},l=Object.keys(e);for(r=0;r<l.length;r++)n=l[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);for(r=0;r<l.length;r++)n=l[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var s=r.createContext({}),u=function(e){var t=r.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},p=function(e){var t=u(e.components);return r.createElement(s.Provider,{value:t},e.children)},c={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},m=r.forwardRef((function(e,t){var n=e.components,a=e.mdxType,l=e.originalType,s=e.parentName,p=o(e,["components","mdxType","originalType","parentName"]),m=u(n),d=a,f=m["".concat(s,".").concat(d)]||m[d]||c[d]||l;return n?r.createElement(f,i(i({ref:t},p),{},{components:n})):r.createElement(f,i({ref:t},p))}));function d(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var l=n.length,i=new Array(l);i[0]=m;var o={};for(var s in t)hasOwnProperty.call(t,s)&&(o[s]=t[s]);o.originalType=e,o.mdxType="string"==typeof e?e:a,i[1]=o;for(var u=2;u<l;u++)i[u]=n[u];return r.createElement.apply(null,i)}return r.createElement.apply(null,n)}m.displayName="MDXCreateElement"},8215:function(e,t,n){var r=n(7294);t.Z=function(e){var t=e.children,n=e.hidden,a=e.className;return r.createElement("div",{role:"tabpanel",hidden:n,className:a},t)}},9877:function(e,t,n){n.d(t,{Z:function(){return p}});var r=n(3117),a=n(7294),l=n(2389),i=n(4726),o=n(6010),s="tabItem_LplD";function u(e){var t,n,l,u=e.lazy,p=e.block,c=e.defaultValue,m=e.values,d=e.groupId,f=e.className,h=a.Children.map(e.children,(function(e){if((0,a.isValidElement)(e)&&void 0!==e.props.value)return e;throw new Error("Docusaurus error: Bad <Tabs> child <"+("string"==typeof e.type?e.type:e.type.name)+'>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.')})),g=null!=m?m:h.map((function(e){var t=e.props;return{value:t.value,label:t.label,attributes:t.attributes}})),v=(0,i.lx)(g,(function(e,t){return e.value===t.value}));if(v.length>0)throw new Error('Docusaurus error: Duplicate values "'+v.map((function(e){return e.value})).join(", ")+'" found in <Tabs>. Every value needs to be unique.');var b=null===c?c:null!=(t=null!=c?c:null==(n=h.find((function(e){return e.props.default})))?void 0:n.props.value)?t:null==(l=h[0])?void 0:l.props.value;if(null!==b&&!g.some((function(e){return e.value===b})))throw new Error('Docusaurus error: The <Tabs> has a defaultValue "'+b+'" but none of its children has the corresponding value. Available values are: '+g.map((function(e){return e.value})).join(", ")+". If you intend to show no default tab, use defaultValue={null} instead.");var k=(0,i.UB)(),y=k.tabGroupChoices,N=k.setTabGroupChoices,w=(0,a.useState)(b),T=w[0],C=w[1],x=[],E=(0,i.o5)().blockElementScrollPositionUntilNextRender;if(null!=d){var O=y[d];null!=O&&O!==T&&g.some((function(e){return e.value===O}))&&C(O)}var j=function(e){var t=e.currentTarget,n=x.indexOf(t),r=g[n].value;r!==T&&(E(t),C(r),null!=d&&N(d,r))},B=function(e){var t,n=null;switch(e.key){case"ArrowRight":var r=x.indexOf(e.currentTarget)+1;n=x[r]||x[0];break;case"ArrowLeft":var a=x.indexOf(e.currentTarget)-1;n=x[a]||x[x.length-1]}null==(t=n)||t.focus()};return a.createElement("div",{className:"tabs-container"},a.createElement("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,o.Z)("tabs",{"tabs--block":p},f)},g.map((function(e){var t=e.value,n=e.label,l=e.attributes;return a.createElement("li",(0,r.Z)({role:"tab",tabIndex:T===t?0:-1,"aria-selected":T===t,key:t,ref:function(e){return x.push(e)},onKeyDown:B,onFocus:j,onClick:j},l,{className:(0,o.Z)("tabs__item",s,null==l?void 0:l.className,{"tabs__item--active":T===t})}),null!=n?n:t)}))),u?(0,a.cloneElement)(h.filter((function(e){return e.props.value===T}))[0],{className:"margin-vert--md"}):a.createElement("div",{className:"margin-vert--md"},h.map((function(e,t){return(0,a.cloneElement)(e,{key:t,hidden:e.props.value!==T})}))))}function p(e){var t=(0,l.Z)();return a.createElement(u,(0,r.Z)({key:String(t)},e))}},7171:function(e,t,n){n.r(t),n.d(t,{frontMatter:function(){return u},contentTitle:function(){return p},metadata:function(){return c},toc:function(){return m},default:function(){return f}});var r=n(3117),a=n(102),l=(n(7294),n(3905)),i=n(9877),o=n(8215),s=["components"],u={id:"results-file",title:"Results file",sidebar_label:"Results file",slug:"/results-file"},p=void 0,c={unversionedId:"results-file",id:"results-file",title:"Results file",description:"All your test results will be saved in a results file. By default, Betterer sets this to be .betterer.results, but you can change that by using the --results option when running Betterer.",source:"@site/docs/results-file.md",sourceDirName:".",slug:"/results-file",permalink:"/betterer/docs/results-file",editUrl:"https://github.com/phenomnomnominal/betterer/edit/master/website/docs/results-file.md",tags:[],version:"current",lastUpdatedBy:"Craig Spence",lastUpdatedAt:1636753986,formattedLastUpdatedAt:"11/12/2021",frontMatter:{id:"results-file",title:"Results file",sidebar_label:"Results file",slug:"/results-file"},sidebar:"docs",previous:{title:"Tests",permalink:"/betterer/docs/tests"},next:{title:"Filters",permalink:"/betterer/docs/filters"}},m=[{value:"BettererFileTest results",id:"bettererfiletest-results",children:[],level:3},{value:"Merge",id:"merge",children:[{value:"Merge options",id:"merge-options",children:[],level:3},{value:"Automerge",id:"automerge",children:[],level:3}],level:2}],d={toc:m};function f(e){var t=e.components,n=(0,a.Z)(e,s);return(0,l.kt)("wrapper",(0,r.Z)({},d,n,{components:t,mdxType:"MDXLayout"}),(0,l.kt)("p",null,"All your test results will be saved in a results file. By default, ",(0,l.kt)("strong",{parentName:"p"},"Betterer")," sets this to be ",(0,l.kt)("inlineCode",{parentName:"p"},".betterer.results"),", but you can change that by using the ",(0,l.kt)("a",{parentName:"p",href:"./running-betterer#start-options"},(0,l.kt)("inlineCode",{parentName:"a"},"--results"))," option when running ",(0,l.kt)("strong",{parentName:"p"},"Betterer"),"."),(0,l.kt)("p",null,"The results file is similar to a ",(0,l.kt)("a",{parentName:"p",href:"https://jestjs.io/docs/en/snapshot-testing"},"Jest Snapshot file"),". It should be ",(0,l.kt)("a",{parentName:"p",href:"./workflow"},"commited along with your code")," and probably shouldn't be ",(0,l.kt)("a",{parentName:"p",href:"./updating-results"},"updated")," manually (although you of course can if you're feeling confident!)."),(0,l.kt)("p",null,"The results file will look something like this:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-javascript"},'// BETTERER RESULTS V2.\nexports[`no hack comments`] = {\n  value: `{\n    "packages/cli/src/cli.ts:1074837834": [\n      [13, 0, 7, "RegExp match", "645651780"]\n    ],\n    "packages/cli/src/init/update-package-json.ts:2842907794": [\n      [34, 4, 7, "RegExp match", "645651780"]\n    ]\n  }`\n};\n')),(0,l.kt)("p",null,"This is a valid JavaScript file, so you can import it and manipulate it if you need to. Each test will have an object that stores its result value, which can be controlled by a tests ",(0,l.kt)("a",{parentName:"p",href:"./betterer.bettererserialiser"},(0,l.kt)("inlineCode",{parentName:"a"},"serialiser"))," and ",(0,l.kt)("a",{parentName:"p",href:"./betterer.bettererprinter"},(0,l.kt)("inlineCode",{parentName:"a"},"printer"))," options."),(0,l.kt)("p",null,"When your tests run, ",(0,l.kt)("strong",{parentName:"p"},"Betterer")," will check to see the result against the expected result in the results file. If the new result is better, the results file will be updated, and that result will be the expected baseline going forward."),(0,l.kt)("h3",{id:"bettererfiletest-results"},(0,l.kt)("a",{parentName:"h3",href:"./betterer.bettererfiletest"},(0,l.kt)("inlineCode",{parentName:"a"},"BettererFileTest"))," results"),(0,l.kt)("p",null,"The above example comes from a ",(0,l.kt)("a",{parentName:"p",href:"./betterer.bettererfiletest"},(0,l.kt)("inlineCode",{parentName:"a"},"BettererFileTest")),", which has some note-worthy details. A ",(0,l.kt)("a",{parentName:"p",href:"./betterer.bettererfiletest"},(0,l.kt)("inlineCode",{parentName:"a"},"BettererFileTest"))," result has the following format:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-javascript"},'exports[testName]: {\n value: `{\n    "relativeFilePath:fileHash": [\n      [issueLine, issueColumn, length, issueMessage, issueHash]\n      // ... more issues\n    ],\n    // ... more files\n }`\n}\n')),(0,l.kt)("div",{className:"admonition admonition-caution alert alert--warning"},(0,l.kt)("div",{parentName:"div",className:"admonition-heading"},(0,l.kt)("h5",{parentName:"div"},(0,l.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,l.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 16 16"},(0,l.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"}))),"caution")),(0,l.kt)("div",{parentName:"div",className:"admonition-content"},(0,l.kt)("p",{parentName:"div"},(0,l.kt)("inlineCode",{parentName:"p"},"fileHash")," and ",(0,l.kt)("inlineCode",{parentName:"p"},"issueHash")," are used to track issues as the lines of code in a file change, or as the file moves around in the codebase. This means they change quite often! Check out the ",(0,l.kt)("a",{parentName:"p",href:"./workflow"},"workflow guide")," for suggested ways to handle this with source control."))),(0,l.kt)("h2",{id:"merge"},"Merge"),(0,l.kt)("p",null,"If you are working in a codebase where there is a lot of changes, you may encounter merge conflicts in the results file. It is possible to resolve these manually, but it is much easier to let ",(0,l.kt)("strong",{parentName:"p"},"Betterer")," handle merging for you!"),(0,l.kt)("p",null,"The ",(0,l.kt)("inlineCode",{parentName:"p"},"merge")," command does a fairly naive merge of the results file."),(0,l.kt)(i.Z,{groupId:"package-manager",defaultValue:"yarn",values:[{label:"Yarn",value:"yarn"},{label:"npm",value:"npm"}],mdxType:"Tabs"},(0,l.kt)(o.Z,{value:"yarn",mdxType:"TabItem"},(0,l.kt)("p",null,"Run ",(0,l.kt)("inlineCode",{parentName:"p"},"yarn betterer merge")," to automatically merge the ",(0,l.kt)("strong",{parentName:"p"},"Betterer")," results file.")),(0,l.kt)(o.Z,{value:"npm",mdxType:"TabItem"},(0,l.kt)("p",null,"Run ",(0,l.kt)("inlineCode",{parentName:"p"},"npm run betterer merge")," to automatically merge the ",(0,l.kt)("strong",{parentName:"p"},"Betterer")," results file."))),(0,l.kt)("h3",{id:"merge-options"},"Merge options"),(0,l.kt)("p",null,"You can pass the following options to ",(0,l.kt)("inlineCode",{parentName:"p"},"merge"),":"),(0,l.kt)("table",null,(0,l.kt)("thead",{parentName:"table"},(0,l.kt)("tr",{parentName:"thead"},(0,l.kt)("th",{parentName:"tr",align:null},"Option"),(0,l.kt)("th",{parentName:"tr",align:null},"Description"),(0,l.kt)("th",{parentName:"tr",align:null},"Default"))),(0,l.kt)("tbody",{parentName:"table"},(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"-r"),", ",(0,l.kt)("inlineCode",{parentName:"td"},"--results")," ","[value]"),(0,l.kt)("td",{parentName:"tr",align:null},"Path to test results file relative to CWD"),(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"./.betterer.results"))))),(0,l.kt)("h3",{id:"automerge"},"Automerge"),(0,l.kt)("p",null,"If you don't ever want to have to think about merging the results file, you can enable automatic merging. Run ",(0,l.kt)("a",{parentName:"p",href:"installation"},(0,l.kt)("inlineCode",{parentName:"a"},"betterer init"))," with the ",(0,l.kt)("a",{parentName:"p",href:"./installation#init-options"},(0,l.kt)("inlineCode",{parentName:"a"},"--automerge")),". ",(0,l.kt)("strong",{parentName:"p"},"Betterer")," will update your git configuration to always run ",(0,l.kt)("inlineCode",{parentName:"p"},"betterer merge")," whenever there is a conflict in the results file."),(0,l.kt)("div",{className:"admonition admonition-caution alert alert--warning"},(0,l.kt)("div",{parentName:"div",className:"admonition-heading"},(0,l.kt)("h5",{parentName:"div"},(0,l.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,l.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 16 16"},(0,l.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"}))),"caution")),(0,l.kt)("div",{parentName:"div",className:"admonition-content"},(0,l.kt)("p",{parentName:"div"},"Automerge is still experimental. Please try it out and ",(0,l.kt)("a",{parentName:"p",href:"https://github.com/phenomnomnominal/betterer/issues"},"create issues on Github")," if anything is weird. If something is broken, you can just delete the Betterer merge config from the ",(0,l.kt)("inlineCode",{parentName:"p"},".gitattributes")," file."))))}f.isMDXComponent=!0}}]);